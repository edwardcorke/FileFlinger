{% extends "template.html" %}
{% block content %}

<!--    <div id="uploadBoxWrapper">-->
        <div id="uploadBox">

            <form action = "http://localhost:5000/" method = "POST" enctype = "multipart/form-data">
                {{ form.hidden_tag() }}
                <!--                    <legend class=""border-bottom mb4>Example Form</legend>-->

                <div class="form-group">
                    <input type="file" name="file" id="fileUpload" hidden="hidden" />
                    <button type="button" id="custom-button" >UPLOAD</button>
                    <br><span id="custom-text"></span>
                </div>

                <div id="formDetails">
<!--                {{ form.email.label }}-->
                    {% if form.email.errors %}
                        {{ form.email(class="inputBox", placeholder="email") }}
                        {% for error in form.email.errors %}
                            {{ error }}
                        {% endfor %}
                    {% else %}
                        {{ form.email(class="inputBox", placeholder="email") }}
                    {% endif %}
                    <br><br>
                    <!--                        {{ form.message.label }}-->
                    {% if form.message.errors %}
                        {{ form.message(class="inputBox", id="messageInputBox", placeholder="message", contenteditable="true") }}
                        {% for error in form.message.errors %}
                            {{ error }}
                        {% endfor %}
                    {% else %}
                        {{ form.message(class="inputBox", id="messageInputBox", placeholder="message", contenteditable="true") }}
                    {% endif %}
                    <br><br>
                        {{ form.submit(id="submitButton") }}
                </div>
            </form>

        </div>
<!--    </div>-->


<script type='text/javascript'>
    const realFileBtn = document.getElementById("fileUpload");
    const customBtn = document.getElementById("custom-button");
    const customTxt = document.getElementById("custom-text");

    customBtn.addEventListener("click", function() {
      realFileBtn.click();
    });

    realFileBtn.addEventListener("change", function() {
      if (realFileBtn.value) {
        customTxt.innerHTML = realFileBtn.value.match(
          /[\/\\]([\w\d\s\.\-\(\)]+)$/
        )[1];
      } else {
        customTxt.innerHTML = "";
      }
    });

    var fileInput = document.getElementById('fileUpload');
    var submitB = document.getElementById('submitButton');
    fileInput.onchange = function showFileSize() {
        if (checkFileSize()){
            window.alert("File exceeds upload limit of 2GB. File selected is " + bytes2str(fileInput.files[0].size));
            customTxt.innerHTML = "";
            submitB.disabled = true;
            submitB.style.color = "red";
        } else {
            submitB.disabled = false;
            submitB.style.color = "black";
        }
    }

    function checkFileSize(){
        var maxFilesize = 2 * 1024 * 1024 * 1024;
        if (!window.FileReader) {
            console.log("The file API isn't supported on this browser yet.");
            return;
        }
        if (!fileInput) {
            console.log("Couldn't find the fileinput element.");
        }
        else {
            var filesize = fileInput.files[0].size;
            if (filesize > maxFilesize) {
                return true;
            }
        }
    }

    function bytes2str(bytes) {
        if (bytes == 0) {
            return "0.00 B";
        }
        var e = Math.floor(Math.log(bytes) / Math.log(1024));
        return (bytes / Math.pow(1024, e)).toFixed(2) +
          ' ' + ' KMGTP'.charAt(e) + 'B';
    }
</script>

{% endblock content %}
